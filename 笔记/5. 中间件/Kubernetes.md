`Kubernetes`ï¼ˆç®€ç§° K8sï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„**å®¹å™¨ç¼–æ’**å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚ç”± Google è®¾è®¡å¹¶å¼€æºï¼ˆåŸºäº Borg ç³»ç»Ÿï¼‰ã€‚

- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - è‡ªåŠ¨åŒ–å®¹å™¨éƒ¨ç½²ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
  - è´Ÿè½½å‡è¡¡ä¸æœåŠ¡å‘ç°ã€‚
  - è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆæ°´å¹³æ‰©å±•ï¼‰ã€‚
  - è‡ªæ„ˆèƒ½åŠ›ï¼ˆå¦‚é‡å¯æ•…éšœå®¹å™¨ã€æ›¿æ¢èŠ‚ç‚¹ï¼‰ã€‚
  - å­˜å‚¨ç¼–æ’ï¼ˆåŠ¨æ€æŒ‚è½½å­˜å‚¨å·ï¼‰ã€‚
  - é…ç½®ä¸å¯†é’¥ç®¡ç†ã€‚



## ä¸€ã€Kubernetes æ¶æ„

Kubernetes é›†ç¾¤ç”± **Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢ï¼‰** å’Œ **Worker èŠ‚ç‚¹ï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰** ç»„æˆã€‚

### 1. Master èŠ‚ç‚¹ç»„ä»¶

(1) **API Server**

- ä½œç”¨ï¼šè¿™æ˜¯ Kubernetes é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æä¾› RESTful API æ¥å£ï¼Œä¾›ç”¨æˆ·ã€å®¢æˆ·ç«¯ä»¥åŠå…¶ä»–ç»„ä»¶ä¸é›†ç¾¤äº¤äº’ã€‚
- ç‰¹ç‚¹ï¼šå”¯ä¸€ä¸ etcd é€šä¿¡çš„ç»„ä»¶ï¼Œè´Ÿè´£çŠ¶æ€å­˜å‚¨å’ŒåŒæ­¥ã€‚

(2) **etcd**

- ä½œç”¨ï¼šä¸€ä¸ªé«˜å¯ç”¨ã€åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ Kubernetes é›†ç¾¤çš„æ‰€æœ‰çŠ¶æ€æ•°æ®ï¼ŒåŒ…æ‹¬æ‰€æœ‰èµ„æºçš„å®šä¹‰
- ç‰¹ç‚¹ï¼š
  - ä¸»èŠ‚ç‚¹ä¾èµ– etcd æ¥æŒä¹…åŒ–é›†ç¾¤çŠ¶æ€
  - ä¸ç›´æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œä»…ä¾› kube-apiserver ä½¿ç”¨ã€‚

(3) **Controller Manager**

- ä½œç”¨ï¼šè¿è¡Œå¤šä¸ªæ§åˆ¶å™¨è¿›ç¨‹ï¼Œç¡®ä¿é›†ç¾¤çš„å®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸€è‡´ã€‚
- ç‰¹ç‚¹: æ‰€æœ‰æ§åˆ¶å™¨ä½œä¸ºä¸€ä¸ªå•ä¸€è¿›ç¨‹è¿è¡Œï¼Œä½†é€»è¾‘ä¸Šç‹¬ç«‹ã€‚

  - **Deployment Controller**ï¼šç®¡ç† **Deployment**ï¼Œç¡®ä¿ Pod æ•°é‡ç¬¦åˆæœŸæœ›å€¼ï¼Œå½“podæŒ‚æ‰çš„æ—¶å€™å†å¯åŠ¨ä¸€ä¸ªã€‚

  - **ReplicaSet Controller**ï¼šç®¡ç† **ReplicaSet**ï¼Œä¿è¯ Pod å‰¯æœ¬æ•°æ­£ç¡®ã€‚

  - **Node Controller**ï¼šæ£€æµ‹ Node æ˜¯å¦å­˜æ´»ï¼Œå®•æœºæ—¶è¿ç§» Podã€‚

  - **Job Controller**ï¼šç®¡ç† **Job** ä»»åŠ¡ï¼Œç¡®ä¿ä¸€æ¬¡æ€§ä»»åŠ¡èƒ½æˆåŠŸå®Œæˆã€‚

(4) **Scheduler**

- ä½œç”¨ï¼šè´Ÿè´£å°† Pod è°ƒåº¦åˆ°åˆé€‚çš„å­èŠ‚ç‚¹ä¸Šè¿è¡Œ
- ç‰¹ç‚¹ï¼š
  - ä¸ç›´æ¥ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»…è´Ÿè´£è°ƒåº¦å†³ç­–ã€‚
  - å¯é€šè¿‡è‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥æ‰©å±•ã€‚

### 2. Worker èŠ‚ç‚¹ç»„ä»¶

(1) **kubelet**

- ä½œç”¨ï¼šç®¡ç†èŠ‚ç‚¹ä¸Šçš„ Pod ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚åˆ›å»ºã€é”€æ¯å®¹å™¨ï¼‰ï¼Œå¹¶ä¸ API Server é€šä¿¡ã€‚
- ç‰¹ç‚¹: 
  - ä¸è´Ÿè´£è°ƒåº¦ï¼Œåªæ‰§è¡Œå’Œç®¡ç†ã€‚
  - å¦‚æœ kubelet å®•æœºï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ Pod æ— æ³•æ­£å¸¸è¿è¡Œã€‚

(2) **kube-proxy**

- ä½œç”¨ï¼šç»´æŠ¤èŠ‚ç‚¹ç½‘ç»œè§„åˆ™ï¼Œå®ç° Service çš„è´Ÿè½½å‡è¡¡å’Œç½‘ç»œè·¯ç”±ã€‚

(3) **å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰**

- ä½œç”¨ï¼šè´Ÿè´£å®é™…è¿è¡Œå®¹å™¨ã€‚



### 3. ä¸¾ä¾‹

å…¥å£ï¼ˆAPI Serverï¼‰

1. ä½ æ‰§è¡Œ `kubectl apply -f nginx-deployment.yaml`ï¼Œè¿™ä¸ªç”¨æˆ·è¯·æ±‚ä¼šé¦–å…ˆå‘é€åˆ°**API Serverï¼ˆkube-apiserverï¼‰**ã€‚
2. API Server è´Ÿè´£**éªŒè¯è¯·æ±‚**ï¼Œç„¶åæŠŠ Nginx çš„éƒ¨ç½²ä¿¡æ¯å­˜å…¥ **etcd**ï¼ˆåˆ†å¸ƒå¼å­˜å‚¨ï¼‰ã€‚

**ğŸ’¡ API Server ç›¸å½“äº Kubernetes çš„â€œå‰å°â€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡å®ƒã€‚**

æ•°æ®å­˜å‚¨ï¼ˆetcdï¼‰

1. API Server å°† `nginx-deployment.yaml` è§£æåï¼ŒæŠŠ**Nginx éœ€è¦çš„å‰¯æœ¬æ•°ï¼ˆ2 ä¸ª Podï¼‰ç­‰ä¿¡æ¯å­˜å…¥ etcd**ã€‚
2. etcd æ˜¯ Kubernetes çš„æ•°æ®åº“ï¼Œè´Ÿè´£å­˜å‚¨**æ‰€æœ‰é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯**ã€‚

**ğŸ’¡ etcd ç›¸å½“äº Kubernetes çš„â€œå¤§è„‘â€ï¼Œè®°å½•æ‰€æœ‰èµ„æºä¿¡æ¯ã€‚**

æ§åˆ¶å™¨ï¼ˆController Managerï¼‰

1. **Deployment Controller** ç›‘å¬åˆ° etcd é‡Œæœ‰ä¸€ä¸ªæ–°çš„ Nginx Deployment éœ€æ±‚ã€‚
2. å®ƒå‘ç°â€œå½“å‰ Nginx Pod æ•°é‡=0ï¼ŒæœŸæœ›=2â€ï¼Œæ‰€ä»¥å†³å®š**åˆ›å»º 2 ä¸ª Pod**ã€‚
3. å®ƒå‘ API Server å‘é€è¯·æ±‚ï¼Œè¦æ±‚åˆ›å»º 2 ä¸ª Nginx Podã€‚

**ğŸ’¡ Controller Manager ç›¸å½“äºâ€œç®¡ç†å‘˜â€ï¼Œè´Ÿè´£è®©é›†ç¾¤ç¬¦åˆé¢„æœŸçŠ¶æ€ã€‚**

è°ƒåº¦ï¼ˆSchedulerï¼‰

1. **Scheduler è´Ÿè´£å†³å®š Nginx Pod åº”è¯¥è¿è¡Œåœ¨å“ªä¸ª Nodeï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰ä¸Šã€‚**
2. å®ƒä¼šæ£€æŸ¥**æ¯ä¸ª Node çš„èµ„æºæƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰**ï¼Œé€‰æ‹©æœ€åˆé€‚çš„èŠ‚ç‚¹è¿è¡Œ Podã€‚
3. é€‰å¥½åï¼Œå®ƒå‘Šè¯‰ API Serverï¼š
   - **Pod 1 â†’ Node A**
   - **Pod 2 â†’ Node B**

**ğŸ’¡ Scheduler ç›¸å½“äºâ€œè°ƒåº¦å‘˜â€ï¼Œå†³å®šä»»åŠ¡åœ¨å“ªé‡Œæ‰§è¡Œã€‚**

è¿è¡Œï¼ˆå·¥ä½œèŠ‚ç‚¹ - Kubelet & å®¹å™¨è¿è¡Œï¼‰

1. **Node A å’Œ Node B** å„è‡ªçš„ **kubelet** å‘ç°ï¼šâ€œå“ï¼ŒAPI Server è®©æˆ‘è¿è¡Œä¸€ä¸ª Nginx Podâ€ã€‚
2. **kubelet** è®©æœ¬èŠ‚ç‚¹çš„ **Container Runtimeï¼ˆæ¯”å¦‚ Docker æˆ– Containerdï¼‰** å»æ‹‰å– `nginx:latest` é•œåƒã€‚
3. é•œåƒä¸‹è½½å®Œæˆåï¼Œ**Container Runtime è¿è¡Œ Nginx å®¹å™¨**ã€‚
4. Nginx Pod å¯åŠ¨æˆåŠŸåï¼Œ**kubelet ä¼šå‘ API Server æ±‡æŠ¥çŠ¶æ€**ï¼ˆ"Nginx Pod è¿è¡ŒæˆåŠŸ"ï¼‰ã€‚

**ğŸ’¡ kubelet ç›¸å½“äºâ€œå·¥äººâ€ï¼Œå®ƒä¼šæ‰§è¡Œè°ƒåº¦å‘˜çš„å‘½ä»¤ï¼Œå®é™…å¯åŠ¨å®¹å™¨ã€‚**



### 4. èµ„æº

**èµ„æºï¼ˆResourceï¼‰** æŒ‡çš„æ˜¯é›†ç¾¤å†…å¯ç®¡ç†çš„å¯¹è±¡ï¼Œæ¯”å¦‚ **Podã€Serviceã€Deployment** ç­‰ã€‚è¿™äº›èµ„æºæè¿°äº† K8s ä¸­çš„å„ç§ç»„ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ **YAML/JSON** é…ç½®ã€`kubectl` å‘½ä»¤ç®¡ç†ã€‚

#### 4.1 Podï¼ˆæœ€å°è¿è¡Œå•å…ƒï¼‰

- **Pod æ˜¯ Kubernetes ä¸­æœ€å°çš„éƒ¨ç½²å•å…ƒ**ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªï¼‰ã€‚
- **æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ªç½‘ç»œå’Œå­˜å‚¨**ï¼Œå¯ä»¥é€šè¿‡ `localhost` äº’ç›¸é€šä¿¡ã€‚
- **Pod ä¸æ˜¯ç›´æ¥åˆ›å»ºçš„**ï¼Œé€šå¸¸ç”± **Deployment** æˆ– **ReplicaSet** ç®¡ç†ã€‚

#### 4.2 Deploymentï¼ˆæ— çŠ¶æ€åº”ç”¨ç®¡ç†ï¼‰

- **ç®¡ç† Pod çš„å‰¯æœ¬æ•°ï¼Œä¿è¯é«˜å¯ç”¨**ã€‚
- **æ”¯æŒæ»šåŠ¨æ›´æ–°ã€å›æ»š**ã€‚
- é€šè¿‡ **ReplicaSet** æœºåˆ¶ç¡®ä¿ Pod æŒç»­è¿è¡Œã€‚

#### 4.3 Serviceï¼ˆç½‘ç»œæš´éœ²ï¼‰

- **Pod çš„ IP ä¼šå˜åŒ–ï¼ŒService æä¾›ç¨³å®šçš„è®¿é—®æ–¹å¼**ã€‚
- **ä¸‰ç§ç±»å‹**ï¼š
  - `ClusterIP`ï¼ˆé»˜è®¤ï¼‰ï¼šä»…é›†ç¾¤å†…å¯è®¿é—®ã€‚
  - `NodePort`ï¼šé€šè¿‡ `NodeIP:ç«¯å£` è®¿é—®ã€‚
  - `LoadBalancer`ï¼šäº‘ç¯å¢ƒä¸‹æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡ã€‚

#### 4.4 Ingressï¼ˆåŸŸåç®¡ç†ï¼‰

- **è´Ÿè´£å°†å¤–éƒ¨æµé‡å¼•å¯¼åˆ° Service**ã€‚
- **æ”¯æŒåŸºäºåŸŸåã€è·¯å¾„çš„è·¯ç”±**ï¼Œå¯ä»¥å®ç°å¤šä¸ªæœåŠ¡å…±ç”¨ä¸€ä¸ª LoadBalancerã€‚

#### 4.5 namespace

Namespace **ç”¨äºéš”ç¦»èµ„æº**ï¼Œæ¯”å¦‚ä¸åŒçš„é¡¹ç›®ã€ç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰ã€‚

#### 4.6 ConfigMapï¼ˆé…ç½®ç®¡ç†ï¼‰

ConfigMap ç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºçš„**é…ç½®ä¿¡æ¯**ï¼Œå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰ã€‚



### 5. ç®¡ç†èµ„æºçš„æ–¹å¼

åœ¨ Kubernetes (K8s) ä¸­ï¼Œ**ç®¡ç†èµ„æº** æœ‰å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬ **æ‰‹åŠ¨ç®¡ç†ã€YAML é…ç½®æ–‡ä»¶ã€kubectl å‘½ä»¤ã€Kubernetes API ç­‰

#### **1. ç›´æ¥ä½¿ç”¨ `kubectl` å‘½ä»¤ç®¡ç†èµ„æº**

1. åˆ›å»ºèµ„æº

å¯ä»¥ä½¿ç”¨ `kubectl create` åˆ›å»ºèµ„æºï¼š

```sh
kubectl create deployment nginx --image=nginx
```

ğŸ’¡ **è¿™ä¸ªæ–¹å¼é€‚ç”¨äºå¿«é€Ÿæµ‹è¯•**ï¼Œä½†æ— æ³•ä¿å­˜èµ„æºçš„å®šä¹‰ï¼Œæ— æ³•è¿½è¸ªå˜åŒ–ã€‚

2. æŸ¥çœ‹èµ„æº

```sh
kubectl get pods         # æŸ¥çœ‹æ‰€æœ‰ Pod
kubectl get services     # æŸ¥çœ‹æ‰€æœ‰ Service
kubectl get deployments  # æŸ¥çœ‹ Deployment
kubectl get nodes        # æŸ¥çœ‹æ‰€æœ‰ Node
```

3. ä¿®æ”¹èµ„æº

```sh
kubectl edit deployment nginx-deployment
```

ğŸ’¡ **ä¼˜ç‚¹**ï¼šå¯ä»¥åœ¨çº¿ä¿®æ”¹èµ„æºï¼Œä¾‹å¦‚å¢åŠ å‰¯æœ¬æ•°ã€æ›´æ–°ç¯å¢ƒå˜é‡ç­‰ã€‚
 ğŸ’¡ **ç¼ºç‚¹**ï¼šä¸æ˜“è¿½è¸ªä¿®æ”¹å†å²ï¼Œæ‰‹åŠ¨æ“ä½œå®¹æ˜“å‡ºé”™ã€‚



#### **2. ä½¿ç”¨ YAML é…ç½®æ–‡ä»¶ç®¡ç†èµ„æº**

ç›¸æ¯” `kubectl create` å‘½ä»¤ï¼Œæˆ‘ä»¬æ›´æ¨è**ä½¿ç”¨ YAML æ–‡ä»¶ç®¡ç† Kubernetes èµ„æº**ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
```

**éƒ¨ç½²èµ„æº**

```sh
kubectl apply -f nginx-deployment.yaml
```

**æ›´æ–°èµ„æº**

```sh
kubectl apply -f nginx-deployment.yaml
```

ğŸ’¡ **ä¼˜ç‚¹**ï¼š

- **å¯é‡å¤éƒ¨ç½²**ï¼ŒåŒæ ·çš„ YAML å¯ä»¥åœ¨ä¸åŒç¯å¢ƒå¤ç”¨ã€‚
- **æ˜“äºç‰ˆæœ¬æ§åˆ¶**ï¼Œå¯ä»¥åœ¨ Git é‡Œè¿½è¸ªå˜æ›´ã€‚
- **å£°æ˜å¼ç®¡ç†**ï¼Œä¿è¯èµ„æºçŠ¶æ€ç¬¦åˆå®šä¹‰ï¼Œè€Œä¸æ˜¯é æ‰‹åŠ¨æ“ä½œã€‚



#### 3. ä½¿ç”¨ Kubernetes API ç®¡ç†èµ„æº

K8s æä¾›äº† **REST API**ï¼Œå¯ä»¥é€šè¿‡ HTTP è¯·æ±‚ç®¡ç†èµ„æºï¼š

```sh
curl -X GET https://<k8s-api-server>/api/v1/pods
```

æˆ–è€…ç”¨ Python ä»£ç è°ƒç”¨ï¼š

```python
from kubernetes import client, config

config.load_kube_config()
v1 = client.CoreV1Api()
pods = v1.list_pod_for_all_namespaces()
for pod in pods.items:
    print(pod.metadata.name)
```

ğŸ’¡ **ä¼˜ç‚¹**ï¼š

- **é€‚åˆè‡ªåŠ¨åŒ–ç®¡ç†**ï¼Œå¯ä»¥å†™ç¨‹åºæ‰¹é‡ç®¡ç† K8s èµ„æºã€‚
- **é€‚ç”¨äº CI/CD æµç¨‹**ï¼Œå¯ä»¥å’Œ GitLabã€Jenkins ç»“åˆã€‚



## äºŒã€Kubernetes æ ¸å¿ƒèµ„æºå¯¹è±¡

### 1. Pod

- **æœ€å°éƒ¨ç½²å•å…ƒ**ï¼šä¸€ä¸ªæˆ–å¤šä¸ªå…±äº«ç½‘ç»œå’Œå­˜å‚¨çš„å®¹å™¨ï¼ˆå¦‚ä¸»å®¹å™¨+Sidecarï¼‰ã€‚
- **ç‰¹ç‚¹**ï¼š
  - æ¯ä¸ª Pod æœ‰å”¯ä¸€ IP åœ°å€ã€‚
  - ç”Ÿå‘½å‘¨æœŸçŸ­æš‚ï¼ˆå¯è¢«è°ƒåº¦åˆ°ä¸åŒèŠ‚ç‚¹ï¼‰ã€‚

### 2. Deploymentï¼ˆPodèµ„æºæ§åˆ¶å™¨ï¼‰

- **ä½œç”¨**ï¼šå£°æ˜å¼ç®¡ç† Pod å‰¯æœ¬é›†ï¼ˆReplicaSetï¼‰ï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°å’Œå›æ»šã€‚
- **å…¸å‹åœºæ™¯**ï¼šæ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ï¼‰ã€‚

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
```

### 3. Serviceï¼ˆæœåŠ¡å‘ç°èµ„æºï¼‰

- **ä½œç”¨**ï¼šä¸ºä¸€ç»„ Pod æä¾›ç¨³å®šçš„è®¿é—®å…¥å£ï¼ˆIP/DNSï¼‰ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€‚
- **ç±»å‹**ï¼š
  - ClusterIPï¼ˆé»˜è®¤ï¼Œé›†ç¾¤å†…éƒ¨è®¿é—®ï¼‰ã€‚
  - NodePortï¼ˆé€šè¿‡èŠ‚ç‚¹ç«¯å£æš´éœ²æœåŠ¡ï¼‰ã€‚
  - LoadBalancerï¼ˆäº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚

### 4. ConfigMap & Secretï¼ˆé…ç½®èµ„æºï¼‰

- **ConfigMap**ï¼šå­˜å‚¨éæ•æ„Ÿé…ç½®æ•°æ®ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰ã€‚
- **Secret**ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€Tokenï¼‰ï¼Œä»¥ Base64 ç¼–ç å­˜å‚¨ã€‚

### 5. Volumeï¼ˆå­˜å‚¨èµ„æºï¼‰

- **ä½œç”¨**ï¼šä¸º Pod æä¾›æŒä¹…åŒ–å­˜å‚¨ã€‚
- **ç±»å‹**ï¼š
  - ä¸´æ—¶å·ï¼ˆemptyDirï¼‰ã€‚
  - æŒä¹…å·ï¼ˆPersistentVolume, PVï¼‰ä¸æŒä¹…å·å£°æ˜ï¼ˆPersistentVolumeClaim, PVCï¼‰ã€‚

### 6. Namespaceï¼ˆé›†ç¾¤çº§åˆ«èµ„æºï¼‰

- **ä½œç”¨**ï¼šé€»è¾‘éš”ç¦»é›†ç¾¤èµ„æºï¼ˆå¦‚å°†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒåˆ†å¼€ï¼‰ã€‚å¦‚æœæ‰€æœ‰çš„ Podã€Serviceã€ConfigMap ç­‰éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œèµ„æºç®¡ç†å°±ä¼šå˜å¾—éå¸¸æ··ä¹±ã€‚Namespace å…è®¸ä½ æŠŠè¿™äº›åº”ç”¨**åˆ’åˆ†åˆ°ä¸åŒçš„ç©ºé—´**ï¼Œè®©å®ƒä»¬å„è‡ªç®¡ç†è‡ªå·±çš„èµ„æºï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚



## ä¸‰ã€Kubernetes ç½‘ç»œæ¨¡å‹

### 1. åŸºæœ¬è¦æ±‚

- æ‰€æœ‰ Pod å¯ç›´æ¥é€šä¿¡ï¼ˆæ— éœ€ NATï¼‰ã€‚
- æ‰€æœ‰èŠ‚ç‚¹å¯ä¸æ‰€æœ‰ Pod é€šä¿¡ã€‚
- Pod çœ‹åˆ°çš„è‡ªèº« IP ä¸å…¶ä»– Pod çœ‹åˆ°çš„ IP ä¸€è‡´ã€‚

### 2. ç½‘ç»œå®ç°ï¼ˆCNI æ’ä»¶ï¼‰

- **å¸¸è§æ’ä»¶**ï¼šCalicoã€Flannelã€Ciliumã€Weave Netã€‚
- **åŠŸèƒ½**ï¼šç®¡ç† Pod ç½‘ç»œï¼ˆIP åˆ†é…ã€è·¯ç”±è§„åˆ™ï¼‰ã€‚

### 3. Service ç½‘ç»œ

- **ClusterIP**ï¼šè™šæ‹Ÿ IPï¼Œé€šè¿‡ kube-proxy çš„ iptables/IPVS è§„åˆ™è½¬å‘åˆ° Podã€‚



## å››ã€å­˜å‚¨ç®¡ç†

### 1. æŒä¹…å·ï¼ˆPersistentVolume, PVï¼‰

- **ä½œç”¨**ï¼šé›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ã€NFSï¼‰ã€‚

### 2. æŒä¹…å·å£°æ˜ï¼ˆPersistentVolumeClaim, PVCï¼‰

- **ä½œç”¨**ï¼šç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚ï¼Œç»‘å®šåˆ° PVã€‚

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
```



## äº”ã€æœ¬åœ°ç¯å¢ƒæµ‹è¯•

`Kubernetes` ä¸€èˆ¬éƒ½è¿è¡Œåœ¨å¤§è§„æ¨¡çš„è®¡ç®—é›†ç¾¤ä¸Šï¼Œç®¡ç†å¾ˆä¸¥æ ¼ï¼Œè¿™å°±å¯¹æˆ‘ä»¬ä¸ªäººæ¥è¯´é€ æˆäº†ä¸€å®šçš„éšœç¢ï¼Œåœ¨å®˜ç½‘ä¸Šæ¨èä½¿ç”¨ `minikube` æ¥å­¦ä¹ Kubernetes ï¼Œå®ƒä»¬éƒ½å¯ä»¥åœ¨æœ¬æœºä¸Šè¿è¡Œå®Œæ•´çš„ Kubernetes ç¯å¢ƒã€‚

### 1. å®‰è£… `minikube`

1. ä¸‹è½½æœ€æ–°MinikubeäºŒè¿›åˆ¶æ–‡ä»¶ï¼š

   ```bash
   curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
   ```

2. å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ï¼š

   ```bash
   sudo install minikube-linux-amd64 /usr/local/bin/minikube
   ```

3. éªŒè¯å®‰è£…ï¼š

   ```bash
   minikube version	
   ```

4. åˆ›å»ºé›†ç¾¤

   ```bash
   minikube start --driver=docker
   ```

5. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

   ```bash
   minikube status
   ```

`minikube` åªèƒ½å¤Ÿæ­å»º `Kubernetes` ç¯å¢ƒï¼Œè¦æ“ä½œ `Kubernetes`ï¼Œè¿˜éœ€è¦å¦ä¸€ä¸ªä¸“é—¨çš„å®¢æˆ·ç«¯å·¥å…·`kubectl`ã€‚



### 2. å®‰è£… `kubectl`

1. ä¸‹è½½æœ€æ–°kubectlï¼š

   ```bash
   curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
   ```

2. å®‰è£…ï¼š

   ```bash
   sudo install kubectl /usr/local/bin/
   ```

3. éªŒè¯ï¼š

   ```bash
   kubectl version --client
   ```

4. æŸ¥çœ‹k8sé›†ç¾¤

   ```bash
   kubectl get nodes
   ```





## å…­ã€éƒ¨ç½²ä¸ç®¡ç†åº”ç”¨

### 1. ä½¿ç”¨ `kubectl` å‘½ä»¤

- å¸¸ç”¨å‘½ä»¤ï¼š

  ```bash
  kubectl apply -f deployment.yaml  # éƒ¨ç½²èµ„æº
  kubectl get pods                 # æŸ¥çœ‹ Pod çŠ¶æ€
  kubectl logs <pod-name>         # æŸ¥çœ‹æ—¥å¿—
  kubectl exec -it <pod-name> -- sh  # è¿›å…¥å®¹å™¨
  ```

### 2. æ»šåŠ¨æ›´æ–°ä¸å›æ»š

- **æ»šåŠ¨æ›´æ–°**ï¼šé€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ Podï¼Œç¡®ä¿é›¶åœæœºã€‚

  ```bash
  kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1
  ```

- **å›æ»š**ï¼š

  ```bash
  kubectl rollout undo deployment/nginx-deployment
  ```

### 3. è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰

- åŸºäº CPU/å†…å­˜ä½¿ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ Pod æ•°é‡ï¼š

  ```bash
  kubectl autoscale deployment nginx-deployment --cpu-percent=50 --min=1 --max=10
  ```



## ä¸ƒã€å®‰å…¨ä¸æƒé™ç®¡ç†

### 1. RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰

- **è§’è‰²ï¼ˆRoleï¼‰**ï¼šå®šä¹‰å¯¹æŸå‘½åç©ºé—´èµ„æºçš„æƒé™ã€‚
- **è§’è‰²ç»‘å®šï¼ˆRoleBindingï¼‰**ï¼šå°†è§’è‰²èµ‹äºˆç”¨æˆ·æˆ–æœåŠ¡è´¦å·ã€‚

### 2. Service Account

- **ä½œç”¨**ï¼šä¸º Pod æä¾›èº«ä»½è®¤è¯ï¼Œç”¨äºè®¿é—® Kubernetes APIã€‚

### 3. ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰

- **ä½œç”¨**ï¼šæ§åˆ¶ Pod ä¹‹é—´çš„ç½‘ç»œæµé‡ï¼ˆå¦‚å…è®¸ç‰¹å®šç«¯å£çš„é€šä¿¡ï¼‰ã€‚



## å…«ã€ç”Ÿæ€ç³»ç»Ÿä¸å·¥å…·

### 1. Helm

- **ä½œç”¨**ï¼šKubernetes åŒ…ç®¡ç†å™¨ï¼Œé€šè¿‡ Charts ç®¡ç†åº”ç”¨éƒ¨ç½²ã€‚

### 2. Operator æ¨¡å¼

- **ä½œç”¨**ï¼šé€šè¿‡è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰æ‰©å±• Kubernetesï¼Œè‡ªåŠ¨åŒ–å¤æ‚åº”ç”¨ç®¡ç†ï¼ˆå¦‚æ•°æ®åº“ï¼‰ã€‚

### 3. ç›‘æ§ä¸æ—¥å¿—

- **å·¥å…·**ï¼š
  - Prometheusï¼ˆç›‘æ§ï¼‰ã€‚
  - Grafanaï¼ˆå¯è§†åŒ–ï¼‰ã€‚
  - EFKï¼ˆElasticsearch + Fluentd + Kibanaï¼Œæ—¥å¿—æ”¶é›†ï¼‰ã€‚



## ä¹ã€å®é™…åº”ç”¨åœºæ™¯

### 1. å¾®æœåŠ¡æ¶æ„

- é€šè¿‡ Service å’Œ Ingress ç®¡ç†æœåŠ¡é—´é€šä¿¡å’Œå¤–éƒ¨è®¿é—®ã€‚

### 2. CI/CD æµæ°´çº¿

- ä¸ Jenkinsã€GitLab CI ç­‰å·¥å…·é›†æˆï¼Œå®ç°è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ã€‚

### 3. æ··åˆäº‘ä¸å¤šé›†ç¾¤ç®¡ç†

- ä½¿ç”¨ Kubefed æˆ– Karmada ç®¡ç†è·¨äº‘ã€è·¨åœ°åŸŸçš„é›†ç¾¤ã€‚



## åã€æœ€ä½³å®è·µ

1. **èµ„æºé™åˆ¶**ï¼šä¸ºå®¹å™¨è®¾ç½® CPU/å†…å­˜çš„ `requests` å’Œ `limits`ã€‚
2. **å¥åº·æ£€æŸ¥**ï¼šé…ç½® `livenessProbe` å’Œ `readinessProbe`ã€‚
3. **æ ‡ç­¾ç®¡ç†**ï¼šä½¿ç”¨æ ‡ç­¾ï¼ˆLabelsï¼‰é«˜æ•ˆç»„ç»‡èµ„æºã€‚
4. **ç¾å¤‡ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½ etcd æ•°æ®ã€‚
